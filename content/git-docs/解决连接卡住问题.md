# 🔧 解决 Cursor 远程连接卡住问题

## 📊 当前状态检查结果

根据诊断，服务器端状态：
- ✅ Cursor Server 进程正在运行（3个进程）
- ✅ 磁盘空间充足（31%使用率，40G可用）
- ✅ 锁文件和日志文件存在
- ✅ SSH 连接正常

## 🎯 问题分析

**现象：** Cursor 显示 "Opening Remote..." 但卡住不动

**可能原因：**
1. Cursor 客户端无法连接到服务器端的 Server
2. 需要手动打开文件夹
3. 网络延迟或超时
4. Cursor Server 端口未正确转发

## 🔍 检查步骤

### 步骤 1: 查看服务器日志

```bash
ssh myserver "tail -20 /run/user/0/cursor-remote-code.log.6ca0869f6193ac0d40fa6ae74ed01260"
```

### 步骤 2: 检查 Cursor 本地日志

Windows 日志位置：
```
C:\Users\Administrator\.cursor\logs\
```

查看最新的日志文件，特别是：
- `remoteagent*.log`
- `exthost*.log`

### 步骤 3: 尝试打开文件夹

**重要：** 如果看到 "Connected to remote." 和 "Open Folder" 按钮，需要：

1. 点击右侧的 **"Open Folder"** 按钮
2. 选择要打开的远程目录（如 `/root` 或 `/home/ubuntu`）
3. 等待文件夹加载

## 🚀 解决方案

### 方案 1: 手动打开文件夹（最常见）

如果 Cursor 显示 "Connected to remote." 和 "Open Folder" 按钮：

1. **点击 "Open Folder" 按钮**
2. **输入或选择远程目录**，例如：
   - `/root` - root 用户主目录
   - `/home/ubuntu` - ubuntu 用户主目录
   - `/var/www` - 网站目录
   - 或其他你需要的目录

3. **等待文件夹加载完成**

### 方案 2: 关闭并重新连接

1. **关闭当前连接：**
   - 点击 Cursor 左下角的 SSH 连接状态
   - 选择 "Close Remote Connection"

2. **清理服务器端（可选）：**
   ```bash
   ssh myserver "pkill -f cursor-server; rm -f /run/user/0/cursor-remote-*"
   ```

3. **重新连接：**
   - 在 Cursor 中重新连接到 `myserver`
   - 等待连接建立
   - 点击 "Open Folder" 选择目录

### 方案 3: 检查网络和端口

如果连接一直卡住，可能是网络问题：

```bash
# 测试 SSH 连接稳定性
ssh -v myserver

# 检查是否有防火墙阻止
# 确保云服务器安全组开放了 SSH 端口（22）
```

### 方案 4: 完全重置（最后手段）

如果以上方法都不行：

1. **清理服务器端：**
   ```bash
   ssh myserver "pkill -f cursor-server; rm -rf ~/.cursor-server/; rm -f /run/user/0/cursor-remote-*"
   ```

2. **关闭 Cursor**

3. **重新打开 Cursor 并连接**

4. **等待 Cursor Server 重新下载安装**（约67MB，需要几分钟）

## 📝 快速操作指南

### 如果看到 "Open Folder" 按钮：

```
1. 点击 "Open Folder" 按钮
2. 输入远程目录路径（如 /root）
3. 按 Enter 或点击确定
4. 等待加载完成
```

### 如果一直卡在 "Opening Remote..."：

```
1. 等待 2-3 分钟（首次连接可能需要下载 Server）
2. 如果还是卡住，关闭连接
3. 运行清理脚本：.\清理并重连.ps1
4. 重新连接
```

## ⚠️ 常见误区

1. **❌ 以为连接成功就能直接使用**
   - ✅ 需要点击 "Open Folder" 选择要打开的目录

2. **❌ 在本地文件夹中操作**
   - ✅ 远程连接后，需要在远程目录中操作

3. **❌ 忽略日志信息**
   - ✅ 查看日志可以快速定位问题

## 🔍 进一步排查

如果问题仍然存在，请提供：

1. **Cursor 本地日志**（最后50行）
   - 位置：`C:\Users\Administrator\.cursor\logs\`

2. **服务器端日志**（最后50行）
   ```bash
   ssh myserver "tail -50 /run/user/0/cursor-remote-code.log.6ca0869f6193ac0d40fa6ae74ed01260"
   ```

3. **具体卡住的界面截图**

4. **是否看到 "Open Folder" 按钮**

---

*根据当前检查，服务器端运行正常，最可能的原因是需要在 Cursor 中点击 "Open Folder" 按钮选择远程目录。*

