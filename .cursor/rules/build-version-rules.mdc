---
name: build-version-rules
description: Build 版本按日期设计，每次更新须使用当日日期并递增序号
---

# Build 版本规则（按日期设计）

## 设计原则

**Build 版本以日期为核心：先看当天日期，再决定序号。**  
用于在线上快速确认是否为最新部署，便于排查「部署了但页面没变」等问题。

## 版本号位置

- **文件**: `app/page.tsx`
- **位置**: 首页右下角展示的 `Build: YYYY-MM-DD-NN` 文本（约第 124 行附近，在包含 `pointerEvents: 'none'` 的 `<div>` 内）。

## 版本号格式（按日期）

- **格式**: `YYYY-MM-DD-NN`
  - **YYYY-MM-DD**：**必须为当前日期**（按自然日，建议用部署/提交当日）。
  - **NN**：当日第几次构建，从 `01` 起递增；同一天多次发布时递增（01 → 02 → 03 …）。
- **更新逻辑**：
  1. 取**当前日期**作为 `YYYY-MM-DD`。
  2. 若当前代码里的 Build 日期**已是今天**：序号在现有基础上 +1（如 01 → 02）。
  3. 若当前代码里的 Build 日期**是昨天或更早**：用**今天**的日期 + `01`（当日第一次）。

## 示例（按日期）

| 当前日期 | 代码里当前 Build | 应改为 |
|----------|------------------|--------|
| 2026-01-29 | 2026-01-28-03 | 2026-01-29-01 |
| 2026-01-29 | 2026-01-29-01 | 2026-01-29-02 |
| 2026-01-29 | 2026-01-29-02 | 2026-01-29-03 |
| 2026-01-30 | 2026-01-29-03 | 2026-01-30-01 |

## 必须更新的时机

- 准备 **push / 合并** 到主分支前。
- 准备触发 **Jenkins 构建 / 部署** 前。
- 任何会改变线上展示内容或行为的提交（含样式、文案、功能、配置等）。

## 检查方式

- 提交前确认 `app/page.tsx` 中的 Build 已按**当前日期**更新，且序号正确（同日递增）。
- 部署后在首页右下角核对 Build 与本次部署日期一致。

## 与 Jenkins 的关系

- Jenkins 打包的是当前代码中的 Build；部署后清除 `.next/cache`、重启 PM2，页面显示该版本。
- 未按日期更新 Build 时，难以从版本号判断部署日期，不利于确认是否发布成功。

---

**记住**：版本按日期设计——先看今天日期，再定序号；每次更新都要改 Build，改完再提交、再部署。
