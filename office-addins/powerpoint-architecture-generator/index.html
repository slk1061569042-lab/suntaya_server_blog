<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>æŠ€æœ¯æ¶æ„å›¾ç”Ÿæˆå™¨</title>
    
    <!-- Office JavaScript API -->
    <script type="text/javascript" src="https://appsforoffice.microsoft.com/lib/1.1/hosted/office.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .container {
            max-width: 500px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        }
        
        h1 {
            color: #333;
            margin-bottom: 10px;
            font-size: 24px;
        }
        
        .subtitle {
            color: #666;
            margin-bottom: 25px;
            font-size: 14px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 600;
            font-size: 14px;
        }
        
        input, textarea, select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            font-family: inherit;
            transition: border-color 0.3s;
        }
        
        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: #667eea;
        }
        
        textarea {
            min-height: 100px;
            resize: vertical;
        }
        
        .btn {
            width: 100%;
            padding: 14px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            margin-top: 10px;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        
        .btn:active {
            transform: translateY(0);
        }
        
        .btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }
        
        .preview {
            margin-top: 20px;
            padding: 15px;
            background: #f5f5f5;
            border-radius: 8px;
            border: 2px dashed #ddd;
            min-height: 200px;
            display: none;
        }
        
        .preview.show {
            display: block;
        }
        
        .preview-title {
            font-weight: 600;
            margin-bottom: 10px;
            color: #333;
        }
        
        .architecture-diagram {
            font-family: 'Courier New', monospace;
            font-size: 12px;
            line-height: 1.6;
            color: #333;
            white-space: pre-wrap;
        }
        
        .status {
            margin-top: 15px;
            padding: 12px;
            border-radius: 8px;
            display: none;
        }
        
        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
            display: block;
        }
        
        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
            display: block;
        }
        
        .template-selector {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .template-card {
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }
        
        .template-card:hover {
            border-color: #667eea;
            background: #f0f0ff;
        }
        
        .template-card.selected {
            border-color: #667eea;
            background: #e8e8ff;
        }
        
        .template-card h3 {
            font-size: 14px;
            margin-bottom: 5px;
            color: #333;
        }
        
        .template-card p {
            font-size: 12px;
            color: #666;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ—ï¸ æŠ€æœ¯æ¶æ„å›¾ç”Ÿæˆå™¨</h1>
        <p class="subtitle">è‡ªåŠ¨ç”ŸæˆæŠ€æœ¯æ¶æ„å›¾å¹¶æ’å…¥åˆ° PowerPoint</p>
        
        <div class="form-group">
            <label>é€‰æ‹©æ¶æ„æ¨¡æ¿</label>
            <div class="template-selector">
                <div class="template-card" data-template="microservices">
                    <h3>å¾®æœåŠ¡æ¶æ„</h3>
                    <p>API Gateway + æœåŠ¡</p>
                </div>
                <div class="template-card" data-template="layered">
                    <h3>åˆ†å±‚æ¶æ„</h3>
                    <p>è¡¨ç°å±‚/ä¸šåŠ¡å±‚/æ•°æ®å±‚</p>
                </div>
                <div class="template-card" data-template="serverless">
                    <h3>Serverless</h3>
                    <p>å‡½æ•°è®¡ç®— + å­˜å‚¨</p>
                </div>
                <div class="template-card" data-template="custom">
                    <h3>è‡ªå®šä¹‰</h3>
                    <p>æ‰‹åŠ¨è¾“å…¥æ¶æ„</p>
                </div>
            </div>
        </div>
        
        <div class="form-group">
            <label for="systemName">ç³»ç»Ÿåç§°</label>
            <input type="text" id="systemName" placeholder="ä¾‹å¦‚ï¼šç”µå•†å¹³å°" value="ç”µå•†å¹³å°">
        </div>
        
        <div class="form-group">
            <label for="components">ç»„ä»¶æè¿°ï¼ˆæ¯è¡Œä¸€ä¸ªï¼‰</label>
            <textarea id="components" placeholder="ä¾‹å¦‚ï¼š&#10;ç”¨æˆ·æœåŠ¡&#10;è®¢å•æœåŠ¡&#10;æ”¯ä»˜æœåŠ¡&#10;æ•°æ®åº“">ç”¨æˆ·æœåŠ¡
è®¢å•æœåŠ¡
æ”¯ä»˜æœåŠ¡
å•†å“æœåŠ¡
æ•°æ®åº“</textarea>
        </div>
        
        <div class="form-group">
            <label for="description">æ¶æ„æè¿°ï¼ˆå¯é€‰ï¼‰</label>
            <textarea id="description" placeholder="æè¿°ç³»ç»Ÿæ¶æ„çš„ç‰¹ç‚¹å’ŒæŠ€æœ¯é€‰å‹..."></textarea>
        </div>
        
        <button class="btn" id="generateBtn">âœ¨ ç”Ÿæˆæ¶æ„å›¾</button>
        
        <div class="preview" id="preview">
            <div class="preview-title">é¢„è§ˆï¼š</div>
            <div class="architecture-diagram" id="diagram"></div>
        </div>
        
        <div class="status" id="status"></div>
    </div>

    <script>
        let selectedTemplate = 'microservices';
        
        // åˆå§‹åŒ– Office.js
        Office.onReady((info) => {
            if (info.host === Office.HostType.PowerPoint) {
                console.log('PowerPoint Add-in å·²åŠ è½½');
                
                // æ¨¡æ¿é€‰æ‹©
                document.querySelectorAll('.template-card').forEach(card => {
                    card.addEventListener('click', () => {
                        document.querySelectorAll('.template-card').forEach(c => c.classList.remove('selected'));
                        card.classList.add('selected');
                        selectedTemplate = card.dataset.template;
                        
                        // æ ¹æ®æ¨¡æ¿å¡«å……ç¤ºä¾‹æ•°æ®
                        fillTemplateData(selectedTemplate);
                    });
                });
                
                // é»˜è®¤é€‰ä¸­ç¬¬ä¸€ä¸ª
                document.querySelector('.template-card').classList.add('selected');
                
                // ç”ŸæˆæŒ‰é’®äº‹ä»¶
                document.getElementById('generateBtn').addEventListener('click', generateArchitecture);
            }
        });
        
        function fillTemplateData(template) {
            const systemNameInput = document.getElementById('systemName');
            const componentsInput = document.getElementById('components');
            const descriptionInput = document.getElementById('description');
            
            switch(template) {
                case 'microservices':
                    systemNameInput.value = 'å¾®æœåŠ¡ç”µå•†å¹³å°';
                    componentsInput.value = 'API Gateway\nç”¨æˆ·æœåŠ¡\nè®¢å•æœåŠ¡\næ”¯ä»˜æœåŠ¡\nå•†å“æœåŠ¡\nåº“å­˜æœåŠ¡\næ¶ˆæ¯é˜Ÿåˆ—\næ•°æ®åº“é›†ç¾¤';
                    descriptionInput.value = 'åŸºäº Spring Cloud çš„å¾®æœåŠ¡æ¶æ„ï¼Œä½¿ç”¨ Nacos ä½œä¸ºæ³¨å†Œä¸­å¿ƒï¼ŒRocketMQ å¤„ç†å¼‚æ­¥æ¶ˆæ¯';
                    break;
                case 'layered':
                    systemNameInput.value = 'ä¸‰å±‚æ¶æ„ç³»ç»Ÿ';
                    componentsInput.value = 'Web å‰ç«¯\nAPI æ¥å£å±‚\nä¸šåŠ¡é€»è¾‘å±‚\næ•°æ®è®¿é—®å±‚\nMySQL æ•°æ®åº“\nRedis ç¼“å­˜';
                    descriptionInput.value = 'ç»å…¸ä¸‰å±‚æ¶æ„ï¼Œå‰åç«¯åˆ†ç¦»ï¼Œä½¿ç”¨ Redis ç¼“å­˜æå‡æ€§èƒ½';
                    break;
                case 'serverless':
                    systemNameInput.value = 'Serverless åº”ç”¨';
                    componentsInput.value = 'å‰ç«¯ SPA\nAPI Gateway\nLambda å‡½æ•°\nDynamoDB\nS3 å­˜å‚¨\nCloudFront CDN';
                    descriptionInput.value = 'åŸºäº AWS Serverless æ¶æ„ï¼ŒæŒ‰éœ€è®¡è´¹ï¼Œè‡ªåŠ¨æ‰©ç¼©å®¹';
                    break;
                case 'custom':
                    systemNameInput.value = '';
                    componentsInput.value = '';
                    descriptionInput.value = '';
                    break;
            }
        }
        
        function generateArchitecture() {
            const btn = document.getElementById('generateBtn');
            const status = document.getElementById('status');
            const preview = document.getElementById('preview');
            const diagram = document.getElementById('diagram');
            
            btn.disabled = true;
            status.className = 'status';
            status.textContent = 'æ­£åœ¨ç”Ÿæˆæ¶æ„å›¾...';
            status.classList.add('success');
            
            const systemName = document.getElementById('systemName').value || 'ç³»ç»Ÿ';
            const components = document.getElementById('components').value.split('\n').filter(c => c.trim());
            const description = document.getElementById('description').value;
            
            // ç”Ÿæˆæ¶æ„å›¾æ–‡æœ¬
            let architectureText = generateArchitectureText(systemName, components, selectedTemplate);
            
            // æ˜¾ç¤ºé¢„è§ˆ
            diagram.textContent = architectureText;
            preview.classList.add('show');
            
            // æ’å…¥åˆ° PowerPoint
            insertToPowerPoint(systemName, architectureText, components, description)
                .then(() => {
                    status.textContent = 'âœ… æ¶æ„å›¾å·²æˆåŠŸæ’å…¥åˆ°å½“å‰å¹»ç¯ç‰‡ï¼';
                    status.classList.remove('error');
                    status.classList.add('success');
                    btn.disabled = false;
                })
                .catch((error) => {
                    status.textContent = 'âŒ é”™è¯¯: ' + error.message;
                    status.classList.remove('success');
                    status.classList.add('error');
                    btn.disabled = false;
                });
        }
        
        function generateArchitectureText(systemName, components, template) {
            let text = `â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n`;
            text += `â”‚      ${systemName} æ¶æ„å›¾              â”‚\n`;
            text += `â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n\n`;
            
            switch(template) {
                case 'microservices':
                    text += generateMicroservicesDiagram(components);
                    break;
                case 'layered':
                    text += generateLayeredDiagram(components);
                    break;
                case 'serverless':
                    text += generateServerlessDiagram(components);
                    break;
                default:
                    text += generateCustomDiagram(components);
            }
            
            return text;
        }
        
        function generateMicroservicesDiagram(components) {
            let diagram = '        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n';
            diagram += '        â”‚  API Gateway â”‚\n';
            diagram += '        â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜\n';
            diagram += '               â”‚\n';
            diagram += '    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n';
            
            const services = components.filter(c => c.includes('æœåŠ¡') || c.includes('Service'));
            const middle = Math.ceil(services.length / 2);
            
            services.forEach((service, index) => {
                if (index < middle) {
                    diagram += `    â”‚  ${service.padEnd(20)} â”‚\n`;
                }
            });
            
            diagram += '    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n';
            diagram += '               â”‚\n';
            diagram += '        â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”\n';
            diagram += '        â”‚  æ¶ˆæ¯é˜Ÿåˆ—    â”‚\n';
            diagram += '        â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜\n';
            diagram += '               â”‚\n';
            diagram += '        â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”\n';
            diagram += '        â”‚  æ•°æ®åº“é›†ç¾¤   â”‚\n';
            diagram += '        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n';
            
            return diagram;
        }
        
        function generateLayeredDiagram(components) {
            let diagram = 'â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n';
            diagram += 'â”‚      è¡¨ç°å±‚ (UI)            â”‚\n';
            diagram += 'â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n';
            diagram += '               â”‚\n';
            diagram += 'â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n';
            diagram += 'â”‚      API æ¥å£å±‚             â”‚\n';
            diagram += 'â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n';
            diagram += '               â”‚\n';
            diagram += 'â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n';
            diagram += 'â”‚     ä¸šåŠ¡é€»è¾‘å±‚              â”‚\n';
            diagram += 'â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n';
            diagram += '               â”‚\n';
            diagram += 'â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n';
            diagram += 'â”‚     æ•°æ®è®¿é—®å±‚              â”‚\n';
            diagram += 'â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n';
            diagram += '               â”‚\n';
            diagram += 'â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n';
            diagram += 'â”‚     æ•°æ®å­˜å‚¨å±‚              â”‚\n';
            diagram += 'â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n';
            
            return diagram;
        }
        
        function generateServerlessDiagram(components) {
            let diagram = '  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n';
            diagram += '  â”‚  å‰ç«¯ SPA    â”‚\n';
            diagram += '  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜\n';
            diagram += '         â”‚\n';
            diagram += '  â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”\n';
            diagram += '  â”‚ API Gateway â”‚\n';
            diagram += '  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜\n';
            diagram += '         â”‚\n';
            diagram += '  â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”\n';
            diagram += '  â”‚ Lambda å‡½æ•° â”‚\n';
            diagram += '  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜\n';
            diagram += '    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”\n';
            diagram += '    â”‚         â”‚\n';
            diagram += 'â”Œâ”€â”€â”€â”´â”€â”€â”€â” â”Œâ”€â”€â”´â”€â”€â”€â”\n';
            diagram += 'â”‚DynamoDBâ”‚ â”‚  S3  â”‚\n';
            diagram += 'â””â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜\n';
            
            return diagram;
        }
        
        function generateCustomDiagram(components) {
            let diagram = '';
            components.forEach((component, index) => {
                if (index > 0) {
                    diagram += '         â”‚\n';
                }
                diagram += `â”Œâ”€â”€â”€â”€â”€â”€â”€â”€${'â”€'.repeat(Math.max(10, component.length))}â”\n`;
                diagram += `â”‚  ${component.padEnd(Math.max(10, component.length))}  â”‚\n`;
                diagram += `â””â”€â”€â”€â”€â”€â”€â”€â”€${'â”€'.repeat(Math.max(10, component.length))}â”˜\n`;
            });
            return diagram;
        }
        
        async function insertToPowerPoint(systemName, architectureText, components, description) {
            return new Promise((resolve, reject) => {
                PowerPoint.run(async (context) => {
                    try {
                        // è·å–å½“å‰å¹»ç¯ç‰‡
                        const slides = context.presentation.slides;
                        const slide = slides.getActiveSlide();
                        
                        // åˆ›å»ºæ ‡é¢˜æ–‡æœ¬æ¡†
                        const titleShape = slide.shapes.addTextBox(
                            architectureText,
                            PowerPoint.ShapeTextOrientation.horizontal,
                            50, 50, 600, 60
                        );
                        titleShape.textFrame.textRange.font.size = 24;
                        titleShape.textFrame.textRange.font.bold = true;
                        titleShape.textFrame.textRange.font.color = "0078D4";
                        
                        // åˆ›å»ºæ¶æ„å›¾æ–‡æœ¬æ¡†
                        const diagramShape = slide.shapes.addTextBox(
                            architectureText,
                            PowerPoint.ShapeTextOrientation.horizontal,
                            50, 150, 600, 400
                        );
                        diagramShape.textFrame.textRange.font.size = 14;
                        diagramShape.textFrame.textRange.font.name = "Consolas";
                        
                        // å¦‚æœæœ‰æè¿°ï¼Œæ·»åŠ æè¿°æ–‡æœ¬æ¡†
                        if (description) {
                            const descShape = slide.shapes.addTextBox(
                                `æ¶æ„è¯´æ˜ï¼š${description}`,
                                PowerPoint.ShapeTextOrientation.horizontal,
                                50, 550, 600, 100
                            );
                            descShape.textFrame.textRange.font.size = 12;
                            descShape.textFrame.textRange.font.color = "666666";
                        }
                        
                        await context.sync();
                        resolve();
                    } catch (error) {
                        reject(error);
                    }
                });
            });
        }
    </script>
</body>
</html>
