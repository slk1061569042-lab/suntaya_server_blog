# 🔍 远程连接卡住问题排查指南

## 📊 问题现象
- Cursor 显示 "Opening Remote..." 状态
- 界面卡住不动
- 显示 "Connected to remote." 但无法打开文件夹

## 🔧 排查步骤

### 步骤 1: 检查 SSH 连接是否正常

在 Windows PowerShell 中测试：

```powershell
# 测试基本 SSH 连接
ssh myserver

# 如果连接成功，说明 SSH 配置正常
# 如果失败，检查 SSH 配置
```

### 步骤 2: 检查 Cursor Remote SSH 日志

Cursor 的日志位置：
```
Windows: %USERPROFILE%\.cursor\logs\
或者: C:\Users\Administrator\.cursor\logs\
```

查看最新的日志文件，特别是：
- `remoteagent.log`
- `exthost.log`
- `remote-ssh.log`

### 步骤 3: 检查服务器上的 Cursor Server

通过 SSH 连接到服务器，检查：

```bash
# 检查 Cursor Server 进程
ps aux | grep cursor

# 检查 Cursor Server 目录
ls -la ~/.cursor-server/

# 检查是否有锁文件
ls -la /run/user/0/cursor-remote-*

# 检查日志文件
tail -f /run/user/0/cursor-remote-code.log
```

### 步骤 4: 检查服务器资源

```bash
# 检查磁盘空间
df -h

# 检查内存使用
free -h

# 检查 CPU 使用
top
```

### 步骤 5: 清理并重新连接

如果发现问题，可以尝试：

```bash
# 1. 清理 Cursor Server 进程
pkill -f cursor-server

# 2. 清理锁文件
rm -f /run/user/0/cursor-remote-lock.*
rm -f /run/user/0/cursor-remote-*.pid

# 3. 清理临时文件（可选）
rm -rf /tmp/cursor-*
```

## 🚨 常见原因及解决方案

### 原因 1: Cursor Server 安装失败

**检查方法:**
```bash
# 检查 Cursor Server 是否存在
ls -la ~/.cursor-server/bin/
```

**解决方案:**
- 手动删除 `~/.cursor-server/` 目录
- 重新连接，让 Cursor 重新安装

### 原因 2: 服务器资源不足

**检查方法:**
```bash
df -h  # 检查磁盘空间
free -h  # 检查内存
```

**解决方案:**
- 清理磁盘空间
- 关闭不必要的进程
- 增加服务器资源

### 原因 3: 网络连接不稳定

**检查方法:**
```bash
# 测试网络延迟
ping 115.190.54.220

# 检查 SSH 连接稳定性
ssh -v myserver
```

**解决方案:**
- 检查网络连接
- 使用稳定的网络
- 配置 SSH 连接保持活跃（已在配置中）

### 原因 4: 权限问题

**检查方法:**
```bash
# 检查目录权限
ls -la ~/.cursor-server/
ls -la /run/user/0/
```

**解决方案:**
```bash
# 修复权限
chmod -R 755 ~/.cursor-server/
chmod 700 /run/user/0/
```

### 原因 5: 端口被占用

**检查方法:**
```bash
# 检查端口占用
netstat -tlnp | grep -E "(40237|36599)"
```

**解决方案:**
- 关闭占用端口的进程
- 或让 Cursor 使用其他端口

## 🔄 快速修复步骤

### 方法 1: 重启 Cursor Remote SSH 连接

1. 在 Cursor 中：
   - 点击左下角 SSH 连接状态
   - 选择 "Close Remote Connection"
   - 重新连接

### 方法 2: 清理服务器端并重连

在服务器上执行：
```bash
# 停止所有 Cursor 相关进程
pkill -f cursor-server
pkill -f cursor-remote

# 清理锁文件和临时文件
rm -f /run/user/0/cursor-remote-*
rm -rf /tmp/cursor-*

# 可选：清理 Cursor Server（会重新下载）
rm -rf ~/.cursor-server/
```

然后在 Cursor 中重新连接。

### 方法 3: 检查并修复 SSH 配置

确保 SSH 配置正确：
```ssh_config
Host myserver
    HostName 115.190.54.220
    Port 22
    User root
    PreferredAuthentications publickey
    IdentityFile ~/.ssh/id_rsa
    ServerAliveInterval 60
    ServerAliveCountMax 3
```

## 📝 调试命令集合

创建一个快速检查脚本：

```bash
#!/bin/bash
echo "=== Cursor Remote SSH 诊断 ==="
echo ""
echo "1. SSH 连接测试:"
ssh -o ConnectTimeout=5 myserver "echo 'SSH连接成功'" || echo "SSH连接失败"
echo ""
echo "2. Cursor Server 进程:"
ssh myserver "ps aux | grep cursor | grep -v grep" || echo "未找到进程"
echo ""
echo "3. Cursor Server 目录:"
ssh myserver "ls -la ~/.cursor-server/bin/ 2>/dev/null | head -5" || echo "目录不存在"
echo ""
echo "4. 磁盘空间:"
ssh myserver "df -h / | tail -1"
echo ""
echo "5. 内存使用:"
ssh myserver "free -h | grep Mem"
echo ""
echo "6. 锁文件:"
ssh myserver "ls -la /run/user/0/cursor-remote-* 2>/dev/null | wc -l"
```

## 🎯 推荐操作顺序

1. ✅ **先测试 SSH 连接** - 确认基本连接正常
2. ✅ **检查服务器资源** - 确认有足够空间和内存
3. ✅ **查看服务器日志** - 找到具体错误信息
4. ✅ **清理并重连** - 如果发现问题，清理后重试
5. ✅ **检查 Cursor 日志** - 查看本地错误信息

---

*如果以上方法都无法解决，请提供具体的错误日志信息*

