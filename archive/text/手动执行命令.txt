========================================
快速修复 WebSocket 1006 错误 - 手动执行命令
========================================

请按照以下顺序，在 PowerShell 中一句一句执行：

--------------------------------------------------
步骤 1: 停止服务器端 Cursor 进程
--------------------------------------------------
ssh myserver "pkill -9 -f cursor-server; pkill -9 -f cursor-remote; sleep 2; echo '进程已停止'"

--------------------------------------------------
步骤 2: 清理服务器端临时文件
--------------------------------------------------
ssh myserver "rm -f /run/user/0/cursor-remote-* 2>/dev/null; rm -rf /tmp/cursor-* 2>/dev/null; rm -rf /tmp/vscode-* 2>/dev/null; echo '文件已清理'"

--------------------------------------------------
步骤 3: 检查 Cursor Server 目录状态
--------------------------------------------------
ssh myserver "if [ -d ~/.cursor-server ]; then echo 'Cursor Server 目录存在'; ls -la ~/.cursor-server/bin/ 2>/dev/null | head -3; else echo 'Cursor Server 目录不存在'; fi"

--------------------------------------------------
步骤 4: 测试 SSH 连接
--------------------------------------------------
ssh -o ConnectTimeout=5 myserver "echo 'SSH连接正常'"

--------------------------------------------------
步骤 5: 检查服务器资源（磁盘和内存）
--------------------------------------------------
ssh myserver "echo '磁盘:'; df -h / | tail -1; echo '内存:'; free -h | grep Mem | awk '{print \"  可用: \" \$7}'"

--------------------------------------------------
可选：如果上述步骤后仍然失败，完全重置 Cursor Server
--------------------------------------------------
ssh myserver "rm -rf ~/.cursor-server/"

========================================
执行完上述命令后的操作
========================================

方法 1: 在 Cursor 中重新加载（推荐）
  1. 点击错误通知中的 'Reload Window' 按钮
  2. 或按 Ctrl+Shift+P，输入 'Reload Window'

方法 2: 完全关闭并重新连接
  1. 点击左下角 'SSH: myserver' 状态
  2. 选择 'Close Remote Connection'
  3. 等待 5 秒
  4. 重新连接到 myserver

方法 3: 如果仍然失败，完全重置 Cursor Server
  执行上面的重置命令后，重新连接（会重新下载安装）

