# ç«‹å³æµ‹è¯•æ„å»ºæµç¨‹

**æ—¶é—´**: 2026-01-19  
**çŠ¶æ€**: å‡†å¤‡æµ‹è¯•

## ğŸ“‹ å½“å‰çŠ¶æ€

### âœ… å·²éªŒè¯çš„é…ç½®

1. **Jenkins Job é…ç½®**:
   - Repository URL: `git@github.com:slk1061569042-lab/suntaya_server_blog.git` âœ…
   - Branch: `*/main` âœ…
   - Credential: `github-ssh-key` âœ…

2. **SSH é…ç½®**:
   - SSH Config: âœ… å·²é…ç½®
   - Known Hosts: âœ… å·²æ·»åŠ 

3. **æ’ä»¶**:
   - Docker Pipeline: âœ… å·²å®‰è£…ï¼ˆæ–‡ä»¶å­˜åœ¨ï¼‰
   - Docker Commons: âœ… å·²å®‰è£…ï¼ˆæ–‡ä»¶å­˜åœ¨ï¼‰
   - Authentication Tokens: âœ… å·²å®‰è£…ï¼ˆæ–‡ä»¶å­˜åœ¨ï¼‰

4. **Jenkinsfile**:
   - Agent: `agent { docker { image 'node:18-alpine' } }` âœ…
   - æ‰€æœ‰æ­¥éª¤å·²ç®€åŒ– âœ…

5. **éƒ¨ç½²ç›®å½•**:
   - è·¯å¾„: `/www/wwwroot/next.sunyas.com` âœ…
   - æƒé™: å¯å†™ âœ…

## ğŸ§ª ç«‹å³æµ‹è¯•æ­¥éª¤

### æ­¥éª¤ 1: åœ¨ Jenkins ä¸­è§¦å‘æ„å»º

1. **è®¿é—® Jenkins**: http://115.190.54.220:14808
2. **è¿›å…¥ Job**: ç‚¹å‡» `suntaya-server-blog`
3. **è§¦å‘æ„å»º**: ç‚¹å‡»å·¦ä¾§èœå•çš„ **Build Now**ï¼ˆç«‹å³æ„å»ºï¼‰

### æ­¥éª¤ 2: è§‚å¯Ÿæ„å»ºè¿‡ç¨‹

æ„å»ºå¼€å§‹åï¼Œè§‚å¯Ÿæ„å»ºæ—¥å¿—ï¼š

1. **ç‚¹å‡»æ„å»ºå·**ï¼ˆå¦‚ `#5`ï¼‰
2. **ç‚¹å‡» Console Output**ï¼ˆæ§åˆ¶å°è¾“å‡ºï¼‰
3. **è§‚å¯Ÿæ¯ä¸ªé˜¶æ®µ**:

#### é˜¶æ®µ 1: Checkout âœ…
åº”è¯¥çœ‹åˆ°ï¼š
```
Cloning repository git@github.com:slk1061569042-lab/suntaya_server_blog.git
Checking out branch main
```

#### é˜¶æ®µ 2: Install Dependencies âœ…
åº”è¯¥çœ‹åˆ°ï¼š
```
Node ç‰ˆæœ¬: v18.x.x
NPM ç‰ˆæœ¬: x.x.x
npm ci æˆ– npm install æˆåŠŸ
```

#### é˜¶æ®µ 3: Lint âœ…
åº”è¯¥çœ‹åˆ°ï¼š
```
æ£€æµ‹åˆ° lint è„šæœ¬ï¼Œå¼€å§‹æ‰§è¡Œ
æˆ–
æœªæ£€æµ‹åˆ° lint è„šæœ¬ï¼Œè·³è¿‡ lint
```

#### é˜¶æ®µ 4: Build Next.js âœ…
åº”è¯¥çœ‹åˆ°ï¼š
```
npm run build æˆåŠŸ
```

#### é˜¶æ®µ 5: Export static site âœ…
åº”è¯¥çœ‹åˆ°ï¼š
```
npm run export æˆåŠŸ
out ç›®å½•å·²åˆ›å»º
```

#### é˜¶æ®µ 6: Deploy to next.sunyas.com âœ…
åº”è¯¥çœ‹åˆ°ï¼š
```
SSH: Connecting from host
SSH: Transferred file(s)
éƒ¨ç½²å®Œæˆ
```

### æ­¥éª¤ 3: éªŒè¯éƒ¨ç½²ç»“æœ

æ„å»ºæˆåŠŸåï¼ŒéªŒè¯éƒ¨ç½²ï¼š

```powershell
# æ£€æŸ¥éƒ¨ç½²ç›®å½•
ssh root@115.190.54.220 "ls -la /www/wwwroot/next.sunyas.com | head -20"

# æ£€æŸ¥æ–‡ä»¶æ—¶é—´æˆ³
ssh root@115.190.54.220 "stat /www/wwwroot/next.sunyas.com/index.html"
```

## ğŸ” å¦‚æœæ„å»ºå¤±è´¥

### æŸ¥çœ‹æ„å»ºæ—¥å¿—

1. è¿›å…¥å¤±è´¥çš„æ„å»º
2. ç‚¹å‡» **Console Output**
3. æŸ¥æ‰¾é”™è¯¯ä¿¡æ¯
4. å‘Šè¯‰æˆ‘å…·ä½“çš„é”™è¯¯

### å¸¸è§é—®é¢˜

1. **æ’ä»¶ä¾èµ–é”™è¯¯**:
   - å¦‚æœçœ‹åˆ° `Invalid agent type "docker"`
   - éœ€è¦åœ¨ Jenkins Web UI ä¸­æ£€æŸ¥æ’ä»¶çŠ¶æ€

2. **ä»£ç æ‹‰å–å¤±è´¥**:
   - æ£€æŸ¥ Credential æ˜¯å¦æ­£ç¡®
   - æ£€æŸ¥ SSH é…ç½®

3. **æ„å»ºå¤±è´¥**:
   - æŸ¥çœ‹ npm é”™è¯¯
   - æ£€æŸ¥ package.json

4. **éƒ¨ç½²å¤±è´¥**:
   - æ£€æŸ¥ Publish Over SSH é…ç½®
   - æ£€æŸ¥éƒ¨ç½²ç›®å½•æƒé™

---

**æç¤º**: æ‰€æœ‰é…ç½®å·²å°±ç»ªï¼Œå¯ä»¥ç›´æ¥åœ¨ Jenkins ä¸­è§¦å‘æ„å»ºæµ‹è¯•ã€‚å¦‚æœæ„å»ºå¤±è´¥ï¼Œå‘Šè¯‰æˆ‘å…·ä½“çš„é”™è¯¯ä¿¡æ¯ã€‚
