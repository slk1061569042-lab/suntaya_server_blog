# æµ‹è¯•è‡ªåŠ¨éƒ¨ç½²æµç¨‹

**æ—¶é—´**: 2026-01-19  
**çŠ¶æ€**: ä»£ç å·²æäº¤ï¼Œå‡†å¤‡æµ‹è¯•

## âœ… å·²å®Œæˆçš„æ­¥éª¤

1. **ä»£ç å·²æäº¤**: Jenkinsfile å·²æäº¤åˆ° GitHub
2. **ä»£ç å·²æ¨é€**: å·²æ¨é€åˆ° `origin/main` åˆ†æ”¯

## ğŸ§ª æµ‹è¯•æ­¥éª¤

### æ­¥éª¤ 1: è§‚å¯Ÿ GitHub Webhook è§¦å‘

1. **è®¿é—® GitHub**: https://github.com/slk1061569042-lab/suntaya_server_blog
2. **æ£€æŸ¥ Webhook äº¤ä»˜**:
   - è¿›å…¥: Settings â†’ Webhooks
   - ç‚¹å‡» Webhook
   - æŸ¥çœ‹ **Recent deliveries**ï¼ˆæœ€è¿‘çš„äº¤ä»˜ï¼‰
   - åº”è¯¥èƒ½çœ‹åˆ°æ–°çš„äº¤ä»˜è®°å½•ï¼ŒçŠ¶æ€ä¸º `200 OK`

### æ­¥éª¤ 2: è§‚å¯Ÿ Jenkins è‡ªåŠ¨æ„å»º

1. **è®¿é—® Jenkins**: http://115.190.54.220:14808
2. **è¿›å…¥ Job**: ç‚¹å‡» `suntaya-server-blog`
3. **è§‚å¯Ÿæ„å»ºå†å²**: 
   - åº”è¯¥èƒ½çœ‹åˆ°æ–°çš„æ„å»ºè‡ªåŠ¨è§¦å‘ï¼ˆå‡ ç§’å†…ï¼‰
   - æ„å»ºå·ä¼šæ˜¾ç¤ºä¸º `#5` æˆ–æ›´é«˜

### æ­¥éª¤ 3: æŸ¥çœ‹æ„å»ºæ—¥å¿—

1. **ç‚¹å‡»æœ€æ–°çš„æ„å»ºå·**ï¼ˆå¦‚ `#5`ï¼‰
2. **ç‚¹å‡» Console Output**ï¼ˆæ§åˆ¶å°è¾“å‡ºï¼‰
3. **è§‚å¯Ÿæ„å»ºè¿‡ç¨‹**ï¼Œåº”è¯¥çœ‹åˆ°ï¼š

```
âœ… Stage 1: Checkout
   - Cloning repository git@github.com:slk1061569042-lab/suntaya_server_blog.git
   - Checking out branch main

âœ… Stage 2: Install Dependencies
   - Node ç‰ˆæœ¬: v18.x.x
   - NPM ç‰ˆæœ¬: x.x.x
   - npm ci æˆ– npm install æˆåŠŸ

âœ… Stage 3: Lint
   - ä»£ç æ£€æŸ¥ï¼ˆå¦‚æœæœ‰ lint è„šæœ¬ï¼‰

âœ… Stage 4: Build Next.js
   - npm run build æˆåŠŸ

âœ… Stage 5: Export static site
   - npm run export æˆåŠŸ
   - out ç›®å½•å·²åˆ›å»º

âœ… Stage 6: Deploy to next.sunyas.com
   - SSH: Connecting from host
   - SSH: Transferred file(s)
   - éƒ¨ç½²å®Œæˆ
```

### æ­¥éª¤ 4: éªŒè¯éƒ¨ç½²ç»“æœ

```powershell
# æ£€æŸ¥éƒ¨ç½²ç›®å½•æ˜¯å¦æœ‰æ–°æ–‡ä»¶
ssh root@115.190.54.220 "ls -la /www/wwwroot/next.sunyas.com | head -20"

# æ£€æŸ¥æ–‡ä»¶æ—¶é—´æˆ³ï¼ˆåº”è¯¥æ˜¯æœ€è¿‘çš„ï¼‰
ssh root@115.190.54.220 "stat /www/wwwroot/next.sunyas.com/index.html"
```

## ğŸ” å¦‚æœæ„å»ºå¤±è´¥

### æ£€æŸ¥æ„å»ºæ—¥å¿—

æŸ¥çœ‹æ„å»ºæ—¥å¿—ä¸­çš„é”™è¯¯ä¿¡æ¯ï¼Œå¸¸è§é—®é¢˜ï¼š

1. **æ’ä»¶ä¾èµ–é”™è¯¯**: 
   - å¦‚æœçœ‹åˆ° `Invalid agent type "docker"`ï¼Œè¯´æ˜æ’ä»¶æœªåŠ è½½
   - éœ€è¦åœ¨ Jenkins Web UI ä¸­æ£€æŸ¥æ’ä»¶çŠ¶æ€

2. **ä»£ç æ‹‰å–å¤±è´¥**: 
   - æ£€æŸ¥ Credential æ˜¯å¦æ­£ç¡®
   - æ£€æŸ¥ SSH Config å’Œ Known Hosts

3. **æ„å»ºå¤±è´¥**: 
   - æŸ¥çœ‹å…·ä½“çš„ npm é”™è¯¯
   - æ£€æŸ¥ package.json æ˜¯å¦æ­£ç¡®

4. **éƒ¨ç½²å¤±è´¥**: 
   - æ£€æŸ¥ Publish Over SSH é…ç½®
   - æ£€æŸ¥éƒ¨ç½²ç›®å½•æƒé™

## ğŸ“Š éªŒè¯æ£€æŸ¥è¡¨

### è‡ªåŠ¨è§¦å‘æµ‹è¯•

- [ ] GitHub Webhook äº¤ä»˜æˆåŠŸï¼ˆ200 OKï¼‰
- [ ] Jenkins è‡ªåŠ¨è§¦å‘æ„å»ºï¼ˆå‡ ç§’å†…ï¼‰
- [ ] æ„å»ºæˆåŠŸå®Œæˆ
- [ ] æ‰€æœ‰é˜¶æ®µéƒ½æ˜¾ç¤º âœ…
- [ ] éƒ¨ç½²ç›®å½•æœ‰æœ€æ–°æ–‡ä»¶

### æœ€ç»ˆéªŒè¯

- [ ] è®¿é—®ç½‘ç«™ç¡®è®¤éƒ¨ç½²æˆåŠŸ
- [ ] æ£€æŸ¥æ–‡ä»¶æ—¶é—´æˆ³ç¡®è®¤æ˜¯æœ€æ–°çš„
- [ ] æ£€æŸ¥æ„å»ºæ—¥å¿—æ— é”™è¯¯

---

**æç¤º**: ä»£ç å·²æ¨é€ï¼Œè¯·è§‚å¯Ÿ Jenkins æ˜¯å¦è‡ªåŠ¨è§¦å‘æ„å»ºã€‚å¦‚æœ 30 ç§’å†…æ²¡æœ‰è‡ªåŠ¨è§¦å‘ï¼Œå¯ä»¥æ‰‹åŠ¨ç‚¹å‡» "Build Now" è¿›è¡Œæµ‹è¯•ã€‚
