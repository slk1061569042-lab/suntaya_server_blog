# Git 命令功能规范文档

## 命令分类与功能说明

### 一、工作区命令（Working Directory Commands）

#### 1. `git add -A` / `git add .` / `git add <file>`
**功能**：将工作区的文件添加到暂存区
**文件流转**：
- 输入：工作区中的文件（新文件或已修改的文件）
- 输出：文件从工作区移动到暂存区
- 条件：文件必须在工作区且不在暂存区
- 注意：已跟踪的文件如果被修改，也需要重新 add

**实现要求**：
- 只能添加工作区中不在暂存区的文件
- 如果文件已经在本地仓库中（已跟踪），但工作区有修改，也应该能 add（当前实现可能有问题）

#### 2. `git status`
**功能**：查看工作区、暂存区的状态
**文件流转**：无文件流转，仅显示状态信息

#### 3. `git restore <file>`
**功能**：撤销工作区的修改，恢复到本地仓库的版本
**文件流转**：
- 输入：工作区中已修改的文件（文件在本地仓库中存在）
- 输出：文件从工作区移除（恢复到本地仓库版本）
- 条件：文件必须在本地仓库中存在

---

### 二、暂存区命令（Staging Area Commands）

#### 1. `git commit -m "msg"` / `git commit`
**功能**：将暂存区的文件提交到本地仓库
**文件流转**：
- 输入：暂存区中的所有文件
- 输出：文件从暂存区移动到本地仓库
- 条件：暂存区必须有文件

**实现要求**：
- 暂存区的文件全部移动到本地仓库
- 暂存区清空
- 如果文件已经在本地仓库中，则更新（去重）

#### 2. `git reset`
**功能**：取消暂存，将文件从暂存区移回工作区
**文件流转**：
- 输入：暂存区中的文件
- 输出：文件从暂存区移回工作区
- 条件：暂存区必须有文件

**实现要求**：
- 文件从暂存区移除
- 文件保留在工作区（如果文件不在工作区，应该添加回去）

---

### 三、本地仓库命令（Local Repository Commands）

#### 1. `git push`
**功能**：将本地仓库的提交推送到远程仓库
**文件流转**：
- 输入：本地仓库中有但远程仓库中没有的文件
- 输出：文件从本地仓库同步到远程仓库
- 条件：本地仓库必须有远程仓库没有的文件

**实现要求**：
- 只推送本地仓库中有但远程仓库中没有的文件
- 文件在远程仓库中出现
- 本地仓库和远程仓库都保留文件

#### 2. `git pull`
**功能**：从远程仓库拉取更新并合并到本地仓库和工作区
**文件流转**：
- 输入：远程仓库中有但本地仓库中没有的文件
- 输出：文件从远程仓库同步到本地仓库和工作区
- 条件：远程仓库必须有本地仓库没有的文件

**特殊情况 - Pull 冲突**：
- 如果工作区有未提交的更改（新文件或暂存区有文件），pull 时会：
  1. 清除暂存区（staging area）
  2. 仍然将远程文件添加到本地仓库和工作区
  3. 显示冲突警告

**实现要求**：
- 找出远程仓库中有但本地仓库中没有的文件
- 将这些文件添加到本地仓库
- 将这些文件添加到工作区
- 如果有冲突，清除暂存区

#### 3. `git reset --soft HEAD~1`
**功能**：撤销最后一次提交，但保留暂存区
**文件流转**：
- 输入：本地仓库中最后一次提交的文件
- 输出：文件从本地仓库移回暂存区
- 条件：本地仓库必须有文件

**实现要求**：
- 移除本地仓库中最后一个文件（模拟最后一次提交）
- 将该文件移回暂存区
- 工作区不变

#### 4. `git reset --hard HEAD~1`
**功能**：完全撤销最后一次提交，清除暂存区和工作区
**文件流转**：
- 输入：本地仓库中最后一次提交的文件
- 输出：文件从本地仓库、暂存区、工作区全部移除
- 条件：本地仓库必须有文件

**实现要求**：
- 移除本地仓库中最后一个文件
- 从暂存区移除该文件（如果存在）
- 从工作区移除该文件（如果存在）

#### 5. `git log`
**功能**：查看提交历史
**文件流转**：无文件流转，仅显示历史信息

---

### 四、远程仓库命令（Remote Repository Commands）

#### 1. `git fetch`
**功能**：仅从远程仓库拉取更新，不合并到工作区
**文件流转**：
- 输入：远程仓库中有但本地仓库中没有的文件
- 输出：文件仅添加到远程仓库（模拟 fetch 后需要手动合并）
- 条件：远程仓库必须有本地仓库没有的文件

**实现要求**：
- 找出远程仓库中有但本地仓库中没有的文件
- 在远程仓库中创建新文件（模拟远程更新）
- 不修改本地仓库和工作区

---

### 五、其他命令（Other Commands）

#### 1. `git stash`
**功能**：暂存当前工作区和暂存区的更改
**文件流转**：
- 输入：暂存区中的所有文件 + 工作区中不在本地仓库的文件
- 输出：文件从暂存区和工作区移动到 stash
- 条件：暂存区或工作区必须有文件

**实现要求**：
- 暂存区的文件移动到 stash
- 工作区中不在本地仓库的文件移动到 stash
- 暂存区和工作区清空

#### 2. `git stash pop`
**功能**：恢复最近一次暂存的更改
**文件流转**：
- 输入：stash 中的文件
- 输出：文件从 stash 移回工作区
- 条件：stash 必须有文件

**实现要求**：
- stash 中的文件移回工作区
- stash 清空

#### 3. `git branch`
**功能**：查看所有分支
**文件流转**：无文件流转，仅显示分支信息

#### 4. `git checkout -b <name>`
**功能**：创建并切换分支
**文件流转**：无文件流转，仅改变当前分支

---

## 文件状态说明

### 文件可能存在的状态：
1. **工作区（Working Directory）**：用户正在编辑的文件
2. **暂存区（Staging Area）**：已准备好提交的文件
3. **本地仓库（Local Repository）**：已提交的文件
4. **远程仓库（Remote Repository）**：已推送到远程的文件
5. **Stash**：临时暂存的文件

### 文件流转规则：
- 文件可以从一个区域移动到另一个区域
- 文件可以同时存在于多个区域（如：在本地仓库和工作区都存在）
- 新文件：只存在于工作区
- 已跟踪文件：存在于本地仓库，可能也在工作区（如果被修改）

---

## 当前实现问题检查清单

### 需要修复的问题：

1. **git add**：
   - ✅ 当前：只能添加新文件（不在本地仓库的文件）
   - ❌ 问题：应该也能添加已跟踪但被修改的文件
   - 🔧 修复：需要区分"新文件"和"已修改文件"

2. **git pull**：
   - ✅ 已修复：现在能正确从远程拉取文件到本地仓库

3. **git reset**：
   - ✅ 当前：从暂存区移除文件
   - ❓ 检查：文件是否应该保留在工作区？

4. **git restore**：
   - ✅ 当前：从工作区移除文件
   - ✅ 正确：恢复到本地仓库版本（移除工作区修改）

5. **git fetch**：
   - ❓ 检查：当前实现是否正确模拟 fetch 行为

---

## 测试场景

### 场景 1：基础工作流
1. 工作区有 file3.txt（新文件）
2. git add -A → file3.txt 进入暂存区
3. git commit -m → file3.txt 进入本地仓库，暂存区清空
4. git push → file3.txt 进入远程仓库

### 场景 2：Pull 冲突
1. 工作区有 file3.txt（未提交）
2. 暂存区有 file3.txt
3. 远程仓库有 file4.txt
4. git pull → 
   - 暂存区清空
   - file4.txt 添加到本地仓库和工作区
   - 显示冲突警告

### 场景 3：修改已跟踪文件
1. 本地仓库有 file1.txt
2. 工作区有 file1.txt（已修改）
3. git add file1.txt → file1.txt 进入暂存区
4. git commit -m → file1.txt 更新到本地仓库

### 场景 4：Reset 操作
1. 暂存区有 file3.txt
2. git reset → file3.txt 从暂存区移除，保留在工作区

### 场景 5：Reset --soft
1. 本地仓库有 file1.txt, file2.txt, file3.txt
2. git reset --soft HEAD~1 → file3.txt 移回暂存区

### 场景 6：Reset --hard
1. 本地仓库有 file1.txt, file2.txt, file3.txt
2. 暂存区有 file3.txt
3. 工作区有 file3.txt
4. git reset --hard HEAD~1 → file3.txt 从所有区域移除
